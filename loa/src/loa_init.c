/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   loa_init.c                                         :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: ymonfray <yukel.monfray@mac.com>           +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2015/06/07 23:26:48 by ymonfray          #+#    #+#             */
/*   Updated: 2015/06/07 23:26:48 by ymonfray         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "loa.h"

int		init_loa(t_env *e, int max)
{
	t_num		**loa;
	// t_num		*one;

	if ((loa = new_num_list(3)))
	{
		e->loa = loa;
		e->max = max;
		e->c->n = 3;
		return (0);
	}
	return (-1);
}

int 	expose_hook(t_env *e)
{
	t_num	*sho;
	int		spos;
	int		rpos;

	if (e->c->on)
	{
		e->c->n += e->c->on;
		e->loa = new_num_list(e->c->n);
		draw_map(e);
		sho = *(e->loa);
		spos = 0;
		rpos = 0;
		while ((sho = sho->next))
		{
			mlx_string_put(e->mlx, e->win, spos + sho->n/2 - 3, sho->n + 10 + 340 * (rpos), 0x00FFFFFF, ft_itoa(sho->n));
			mlx_string_put(e->mlx, e->win, spos + sho->n/2 - 3, sho->n + 42 + 340 * (rpos), 0x00FFFFFF, ft_itoa(sho->m));
			mlx_string_put(e->mlx, e->win, spos + sho->n/2 - 3, sho->n + 74 + 340 * (rpos), 0x00FFFFFF, ft_itoa((sho->m != 0)*(sho->n - sho->m)));
			spos += sho->n;
			if (spos > WIN_WIDTH)
			{
				spos -= WIN_WIDTH;
				rpos++;
			}
		}
		mlx_string_put(e->mlx, e->win, 420, 320, 0x00FFFFFF, ft_strjoin("LoA N: ", ft_itoa(e->c->n-2)));
	}
	e->c->on = 0;
	// sleep(1);
	return (0);
}

// 17664
// [2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97]
//  1 1 1 1 1  1
//  rest 6

 


// N: 97566979977529059755935448561679733175364615466507370090593097267731585288325376202920785727255664918021900855942621176004608
// N: 32522326659176353251978482853893244391788205155502456696864365755910528429441792067640261909085221639340633618647540392001536
// N: 6504465331835270180687180016012003300461521673233085864236363369518131544430164107086247358895355635128327046775767472013312
// N: 929209333119324353465000408963022398092370895985744898028097426151159340405933649801767928317344438298671692124550764429312
// N: 84473575738120394101546498276586391382345793960822670150507046618628213682292994064216810873587815794411206113049570181120
// N: 6497967364470799105215381407800585565791811977354255243007274899840415718332376584377663127105830432258832564441181061120
// N: 382233374380635245699247832793548253154703820914380714288231224197011813831295753836411941462998863790994844066624045056
// N: 20117546020033435045102658547041376219562334001598906178054773647834611996378824342659935899181440643099593869004636160
// N: 874675913914497200219080177890975167779256701900433726455049911152043292233743460156865378009638129926911616822018048
// N: 30161238410844732550486023225903919145837973939753828742015121690216966232729503046756046965419192910247419216658432
// N: 972943174543378434092279381754772805147963238094940195659045362697120903865941930379985398894555848338413893713920
// N: 26295761474145365046374016299073394772397331023235461950027003319549056272036664765823137173954987814030401339392
// N: 641360035954764955545984387031148114067154588411642967625866981889704452887201412716606758924256257169233543168
// N: 14915349673366627358261227551076410173396242737759891553323333326253294404680921258266773686065677406679597056
// N: 317347865390779312429510292863706042049947933686391432373580347080916904392838152233357056344671285021769728
// N: 5987695573410929961982614657544773713747163637242518863319992888484564089795335093977008663860958694735872
// N: 101486365651032705825351582292903775157669912258935274559797565731898727591498133599236111454908446670848
// N: 1663710912312011587213082870696345237187449320534048438700161759452363319220099793205821401311068815360
// N: 24831506153910620588692646295424312738949279003581683763142304526026943794221644093286630753585594368
// N: 349739523294515802605435388488268767074824289196984477639045353447214432309321318213015292180692992
// N: 4790952373897476553108266616532255800361940429170059734646981338812355111517443771515752356511744
// N: 60644966758195905641741429181569864471561992260937134582755725572295683708761498671003950120960
// N: 730662250098745887377539148816758379330212078154490828527413576854823478730827504539100250112
// N: 8209688203356696217596603492196759843243494270853150081301584423387007074436707974517882880
// N: 84635960859347384706598341441095693813486126932542133687017346890945038445841806669119488
// N: 837979810488587935685030064656179172710489176594082413363393899048373038123074919071744
// N: 8135726315423183406055134082694316061986175454305019149817335727581169219093858877440
// N: 76034825377786763071912655019159572093358048948427058061230238602302070551648141312
// N: 697567205300795977959087813388614296536749186945330326575219293528573513681600512
// N: 6173161108856601494768254408159124466233793653804447337789133031361807657205760
// N: 48607567786272454637975095555320049989071115666623330087905418002726918291456
// N: 371050135773072169358960080973122404525910512944056092584242946574934605824
// N: 2708395151628263866737351517443394288606339893577361622367753157845450752
// N: 19484857205958731884012546196008451460948212261511895423875614429413376
// N: 130770853731266648100833495062988012142575408081979468131017995321344
// N: 866032143915673223219570434883075460436236444473204555398336479232
// N: 5516128305195370662353743237356796792118087835334676192864239616
// N: 33841277945983869444439576353344736407665807443647126675914752
// N: 202642382910083052969179580400574568594663091924057687326720
// N: 1171343253815509029068539406379423236089876532875459821568
// N: 6543817060421837482062269554240693279229132496609214464
// N: 36153685416695235383156050643386483902648519571275776
// N: 189286311082174001369737849213946157801368128061440
// N: 980758088508673640236414250930923480933942165504
// N: 4978467454358749619780739884300670162910052352
// N: 25017424393762562844311719303212642871541760
// N: 118565992387500297106963101386446011891712
// N: 531686064517938546627969873416219000832
// N: 2342229359109861496099020710606798848
// N: 10228075803973194628323131028144128
// N: 43897321047095256997960129445888
// N: 183670799360231184781855948800
// N: 762119499420046448662675456
// N: 3036332667012137168666624
// N: 11814523996156175843328
// N: 44922144472076713984
// N: 166996819598798208
// N: 616224426563831
// N: 2224636919003
// N: 7916857363
// N: 27974761
// N: 95477
// N: 311
// N: 1
// N: 0

// [2,
// 3,
// 5,
// 7,
// 11,
// 13,
// 17,
// 19,
// 23,
// 29,
// 31,
// 37,
// 41,
// 43,
// 47,
// 53,
// 59,
// 61,
// 67,
// 71,
// 73,
// 79,
// 83,
// 89,
// 97,
// 101,
// 103,
// 107,
// 109,
// 113,
// 127,
// 131,
// 137,
// 139,
// 149,
// 151,
// 157,
// 163,
// 167,
// 173,
// 179,
// 181,
// 191,
// 193,
// 197,
// 199,
// 211,
// 223,
// 227,
// 229,
// 233,
// 239,
// 241,
// 251,
// 257,
// 263,
// 269,
// 271,
// 277,
// 281,
// 283,
// 293,
// 307,
// 311,
// 313,
// 317,
// 331,
// 337,
// 347,
// 349,
// 353,
// 359,
// 367,
// 373,
// 379,
// 383,
// 389,
// 397,
// 401,
// 409,
// 419,
// 421,
// 431,
// 433,
// 439,
// 443,
// 449,
// 457,
// 461,
// 463,
// 467,
// 479,
// 487,
// 491,
// 499,
// 503,
// 509,
// 521,
// 523,
// 541,
// 547,
// 557,
// 563,
// 569,
// 571,
// 577,
// 587,
// 593,
// 599,
// 601,
// 607,
// 613,
// 617,
// 619,
// 631,
// 641,
// 643,
// 647,
// 653,
// 659,
// 661,
// 673,
// 677,
// 683,
// 691,
// 701,
// 709,
// 719,
// 727,
// 733,
// 739,
// 743,
// 751,
// 757,
// 761,
// 769,
// 773,
// 787,
// 797,
// 809,
// 811,
// 821,
// 823,
// 827,
// 829,
// 839,
// 853,
// 857,
// 859,
// 863,
// 877,
// 881,
// 883,
// 887,
// 907,
// 911,
// 919,
// 929,
// 937,
// 941,
// 947,
// 953,
// 967,
// 971,
// 977,
// 983,
// 991,
// 997]



int		new_window(size_t width, size_t height, t_env *e)
{
	e->mlx = mlx_init();
	if (e->mlx)
	{
		e->win = mlx_new_window(e->mlx, width, height, "L^o^A");
		if (e->win)
			return (0);
	}
	return (-1);
}

int 	key_hook(int keycode, t_env *e)
{
	t_ctl	*c;

	c = e->c;
	if (keycode == KEY_ESC)
		exit(0);
	c->on += (keycode == KEY_PLUS) ? 1 : (0 - (keycode == KEY_MINUS));

	if (keycode == KEY_SPC)
		mlx_clear_window(e->mlx, e->win);
	e->c = c;
	// printf("Keycode: %d\n", keycode);
	mlx_destroy_image(e->mlx, e->i->img);
	e->i->img = mlx_new_image(e->mlx, WIN_WIDTH, WIN_HEIGHT);
	e->i->data = mlx_get_data_addr(e->i->img, &(e->i->bpp), &(e->i->s_line), &(e->i->endian));
	expose_hook(e);
	return (0);	
}


int			init_input(t_env *e)
{
	t_ctl	*c;

	c = (t_ctl *)malloc(sizeof(t_ctl));
	if (c)
	{
		c->on = 0;
		e->c = c;
		mlx_hook(e->win, KeyPress, KeyRelease, key_hook, e);
		// mlx_mouse_hook(e->win, mouse_hook, e);    
		mlx_expose_hook(e->win, expose_hook, e);
		mlx_clear_window(e->mlx, e->win);
		return (0);
	}
	return (-1);
}

int			init_image(t_env *e)
{
	t_im	*i;

	i = (t_im *)malloc(sizeof(t_im));
	if (e && i)
	{	
		e->i = i;
		e->i->img = mlx_new_image(e->mlx, WIN_WIDTH, WIN_HEIGHT);
		e->i->bpp = DEFAULT_BPP;
		e->i->s_line = WIN_WIDTH;
		e->i->n_line = WIN_HEIGHT;
		e->i->endian = DEFAULT_ENDIAN;
		e->i->data = mlx_get_data_addr(e->i->img, &(e->i->bpp), &(e->i->s_line), &(e->i->endian));
		// printf("BUG\n");
		return (0);
	}
	return (-1);
}

int			init_env(t_env *e, int max)
{
	if (!init_input(e) && !init_image(e) && !init_loa(e, max))
		return (0);
	return (-1);
}

int			init_all(t_env *e, int max)
{
	if (!new_window(WIN_WIDTH, WIN_HEIGHT, e))
		if (!init_env(e, max))
			return (0);
	return (-1);
}
